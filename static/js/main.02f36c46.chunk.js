(this["webpackJsonpweb-bluetooth"]=this["webpackJsonpweb-bluetooth"]||[]).push([[0],{14:function(e,t,a){e.exports=a(24)},19:function(e,t,a){},23:function(e,t,a){},24:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),c=a(8),i=a.n(c),s=(a(19),a(6)),o=a(11),u=a(4),l=a(1),v=a.n(l),h=a(2),d=a(9),p=a(10),f=a(3),m=a(13),b=a(12),w=a(5),y=a.n(w),k=function(e){Object(m.a)(a,e);var t=Object(b.a)(a);function a(e){var r;return Object(d.a)(this,a),(r=t.call(this,e)).startNotificationHR=Object(h.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.startNotification(10807);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),r.stopNotificationHR=Object(h.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.stopNotification(10807);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),r.state={device:void 0,server:void 0,batteryInfo:void 0,isBluetoothAvailable:!1,characteristics:{},hrmId:void 0,heartRateHistory:[]},r.onClick=r.onClick.bind(Object(f.a)(r)),r.onTracking=r.onTracking.bind(Object(f.a)(r)),r}return Object(p.a)(a,[{key:"componentDidMount",value:function(){this.onInitialized()}},{key:"onInitialized",value:function(){var e=Object(h.a)(v.a.mark((function e(){var t,a,r=this;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=navigator.bluetooth)||void 0===t?void 0:t.getAvailability();case 2:a=e.sent,this.setState({isBluetoothAvailable:a}),"onavailabilitychanged"in navigator.bluetooth&&navigator.bluetooth.addEventListener("availabilitychanged",(function(e){var t;r.setState({isBluetoothAvailable:!0===(null===(t=e)||void 0===t?void 0:t.value)})}));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onClick",value:function(){var e=Object(h.a)(v.a.mark((function e(t){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.preventDefault(),console.log("Button onClicked"),!y.a.isNil(navigator.bluetooth)){e.next=5;break}throw new Error("Browser doesn't support intergrating bluetooth");case 5:return e.next=7,this.connect();case 7:a=e.sent,this.setState((function(e){return{device:null===a||void 0===a?void 0:a.device,server:null===a||void 0===a?void 0:a.server,characteristics:Object(u.a)(Object(u.a)({},e.characteristics),null===a||void 0===a?void 0:a.characteristics)}})),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0);case 14:case"end":return e.stop()}}),e,this,[[0,11]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onTracking",value:function(){var e=Object(h.a)(v.a.mark((function e(t){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.preventDefault(),e.next=4,this.startNotificationHR();case 4:if(a=e.sent,console.log("Trying to start notification for HeartRateMeasurement",a),!y.a.isNil(a)){e.next=8;break}throw new Error("Failed to tracking HR");case 8:return e.next=10,this.handleHeartRateMeasurement(a);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"handleHeartRateMeasurement",value:function(){var e=Object(h.a)(v.a.mark((function e(t){var a=this;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.addEventListener("characteristicvaluechanged",(function(e){var t=e,r=a.parseHR(t.target.value);a.setState((function(e){return{heartRate:r.heartRate,heartRateHistory:[].concat(Object(o.a)(e.heartRateHistory),[r.heartRate||0])}}))}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"connect",value:function(){var e=Object(h.a)(v.a.mark((function e(){var t,a,r,n,c,i;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.bluetooth.requestDevice({filters:[{services:["heart_rate"]}],optionalServices:["battery_service","device_information"]});case 3:return t=e.sent,e.next=6,t.gatt.connect();case 6:return a=e.sent,e.t0=console,e.next=10,a.getPrimaryServices();case 10:return e.t1=e.sent,e.t0.log.call(e.t0,"Connected successfully with  services: ",e.t1),console.log("Devices:",t),e.next=15,a.getPrimaryService("heart_rate");case 15:return r=e.sent,n={},c=[10807],e.next=20,Promise.all(c.map(function(){var e=Object(h.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=s.a,e.t1={},e.t2=t,e.next=5,r.getCharacteristic(t);case 5:return e.t3=e.sent,e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 20:return n=e.sent.reduce((function(e,t){return Object(u.a)(Object(u.a)({},e),t)}),n),i={device:t,server:a,characteristics:n},console.log("Connection result: ",i),e.abrupt("return",i);case 26:e.prev=26,e.t2=e.catch(0),console.error(e.t2);case 29:case"end":return e.stop()}}),e,null,[[0,26]])})));return function(){return e.apply(this,arguments)}}()},{key:"getBodySensorLocation",value:function(){var e=Object(h.a)(v.a.mark((function e(){var t,a,r,n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=this.state.characteristics)||void 0===t||null===(a=t.body_sensor_location)||void 0===a?void 0:a.readValue();case 2:return r=e.sent,e.next=5,null===r||void 0===r?void 0:r.getUint8(0);case 5:n=e.sent,e.t0=n,e.next=0===e.t0?9:1===e.t0?10:2===e.t0?11:3===e.t0?12:4===e.t0?13:5===e.t0?14:6===e.t0?15:16;break;case 9:return e.abrupt("return","Other");case 10:return e.abrupt("return","Chest");case 11:return e.abrupt("return","Wrist");case 12:return e.abrupt("return","Finger");case 13:return e.abrupt("return","Hand");case 14:return e.abrupt("return","Ear Lobe");case 15:return e.abrupt("return","Foot");case 16:return e.abrupt("return","Unknown");case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"parseHR",value:function(e){var t=e.getUint8(0),a={},r=1;1&t?(a.heartRate=e.getUint16(r,!0),r+=2):(a.heartRate=e.getUint8(r),r+=1);var n=2&t;if(4&t&&(a.contactDetected=!!n),8&t&&(a.energyExpended=e.getUint16(r,!0),r+=2),16&t){for(var c=[];r+1<e.byteLength;r+=2)c.push(e.getUint16(r,!0));a.rrIntervals=c}return a}},{key:"readValue",value:function(){var e=Object(h.a)(v.a.mark((function e(t){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(a=this.state.characteristics[t])||void 0===a?void 0:a.readValue();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"writeValue",value:function(){var e=Object(h.a)(v.a.mark((function e(t,a){var r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(r=this.state.characteristics[t])||void 0===r?void 0:r.writeValue(a);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"startNotification",value:function(){var e=Object(h.a)(v.a.mark((function e(t){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null===(a=this.state.characteristics[t])||void 0===a?void 0:a.startNotifications());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopNotification",value:function(){var e=Object(h.a)(v.a.mark((function e(t){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null===(a=this.state.characteristics[t])||void 0===a?void 0:a.stopNotifications());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e,t,a,r=this.state,c=r.device,i=r.server;return n.a.createElement("div",{className:"container text-left"},n.a.createElement("div",{className:"row"},n.a.createElement("h3",null,"Bluetooth status: ",this.state.isBluetoothAvailable?"available":"unavailable")),n.a.createElement("div",{className:"row"},n.a.createElement("h3",null,"Devices:")),n.a.createElement("div",{className:"row"},n.a.createElement("label",{htmlFor:"",className:"col-md-4"},"Name: ",null===c||void 0===c?void 0:c.name),n.a.createElement("label",{htmlFor:"",className:"col-md-4"},"HRM ID: ",this.state.hrmId),n.a.createElement("label",{htmlFor:"",className:"col-md-4"},"Connected: ",(null===i||void 0===i?void 0:i.connected)?"yes":"no")),n.a.createElement("div",{className:"row"},n.a.createElement("label",{htmlFor:"",className:"col-md-3"},"Battery information"),n.a.createElement("label",{htmlFor:"",className:"col-md-3"},"Level: ",null===(e=this.state.batteryInfo)||void 0===e?void 0:e.level),n.a.createElement("label",{htmlFor:"",className:"col-md-3"},"Level state: ",null===(t=this.state.batteryInfo)||void 0===t?void 0:t.levelState),n.a.createElement("label",{htmlFor:"",className:"col-md-3"},"Power state: ",null===(a=this.state.batteryInfo)||void 0===a?void 0:a.powerState)),n.a.createElement("div",{className:"row"},n.a.createElement("h3",null,"HeartRate: ",this.state.heartRate)),n.a.createElement("div",{className:"row"},n.a.createElement("button",{className:"btn btn-primary",onClick:this.onClick},"Discover"),n.a.createElement("button",{className:"btn btn-success",disabled:y.a.isNil(this.state.device)||y.a.isNil(this.state.server)||!this.state.server.connected,onClick:this.onTracking},"Tracking")),n.a.createElement("div",{className:"row"},n.a.createElement("h3",null,"HeartRate History: "),this.state.heartRateHistory.join(", ")))}}]),a}(n.a.Component);var g=function(){return n.a.createElement("div",{className:"App"},n.a.createElement("header",{className:"App-header"},n.a.createElement("label",null,"Build date: ","8/17/2020, 3:19:32 PM"),n.a.createElement(k,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(23);i.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(g,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[14,1,2]]]);
//# sourceMappingURL=main.02f36c46.chunk.js.map